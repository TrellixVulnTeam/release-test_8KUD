/* eslint @typescript-eslint/no-var-requires: "off" */
const { merge } = require('webpack-merge');
const env = require('./envs');
const subconfigs = require('./subconfigs');

module.exports = (appName, bundles, {
  withHtml = 'index.ejs',
  assetsOptions = {},
  skipVendors = false,
  minimize = true,
  shortMode = false,
  includedApplications = [],
  autoAuth = false,
  babelrc,
} = {}) => merge(
  subconfigs.mode(),
  subconfigs.io(bundles, appName),
  subconfigs.babelLoader(babelrc),
  subconfigs.svgLoader(),
  subconfigs.define({ appName, autoAuth }),
  subconfigs.devServer(),
  subconfigs.devTools(appName),
  subconfigs.vendors(skipVendors),
  subconfigs.html(withHtml),
  subconfigs.minify(minimize),
  subconfigs.assets(assetsOptions),
  subconfigs.includeOnly(includedApplications, shortMode),
  subconfigs.platformSDKConfig({ appName, autoAuth }),
  subconfigs.platformSDK(),
  subconfigs.bundleAnalyzer(env.ANALYZE),
  subconfigs.optimizations(),
  subconfigs.progressPlugin(!env.NO_PROGRESS),
);
