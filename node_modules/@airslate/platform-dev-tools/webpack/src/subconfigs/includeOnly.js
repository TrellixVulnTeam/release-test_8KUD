/* eslint-disable @typescript-eslint/no-var-requires */
const difference = require('lodash/fp/difference');
const excludedApplications = require('./applicationList');
const env = require('../envs');

const isExcludedByPath = (path) => (app) => path.includes(`node_modules/${app}`);

module.exports = (applications = [], shortMode = false) => {
  if (env.__LOCAL__ && shortMode && Array.isArray(applications)) {
    const redundant = difference(excludedApplications, applications);
    return ({
      module: {
        rules: [{
          include: (path) => redundant.some(isExcludedByPath(path)),
          loader: 'null-loader',
        }],
      },
    });
  }
  return {};
};
